# CPM + риск к выбранной цели (вехе)

Это прототип веб‑обработки (Streamlit) + бэкэнда расчёта (Python), который:
- читает выгрузку задач из Excel (экспорт из MS Project/Project Server),
- раскрывает связи на суммарные задачи до уровня листовых задач,
- строит сеть работ,
- считает CPM **к выбранной пользователем цели** (по `goal_id`),
- рассчитывает риск‑метрики по задачам (вероятность задержки + средняя задержка + риск влияния на цель R2),
- выдаёт рекомендации текстом (UI показывает список рекомендаций в табличном поле).

## Файлы
- `app.py` — фронт (Streamlit)
- `project_backend_v4.py` — бэкэнд (CPM + риск)
- `requirements.txt` — зависимости для деплоя

## Требования к вводу
Обязательные поля в форме:
- Текст цели (любая формулировка)
- `goal_id` — ИД целевой вехи/задачи (обычно веха с длительностью 0)

Если цель или `goal_id` не заполнены — расчёт не выполняется.

## Политика обработки пустых предшественников (важно)
- Для **вех (D=0)** и **суммарных задач** отсутствие предшественников считается нормой.
- Для **листовых НЕ‑вех** задач без предшественников связи автоматически **не добавляются** (политика).
  Такие задачи считаются стартовыми внутри своего раздела/подраздела; факт фиксируется в предупреждениях и рекомендациях.
  В CPM старт якорится по плановому началу задачи, если входящих связей в анализируемой сети нет.

## Локальный запуск
```bash
pip install -r requirements.txt
streamlit run app.py
```

## Загрузка MPP
MPP (MS Project) в этом прототипе **не парсится напрямую**.
Поддерживаемый путь: экспортируйте план в Excel (таблица задач) и загрузите `.xlsx`.
